full contents of services/substitutionService.ts